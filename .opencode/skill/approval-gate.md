# 承認ゲート共通フォーマット

> **参照元**: 各ワークフロー（req-workflow, basic-design-workflow, detailed-design-workflow, implement-issues）から分離された承認ゲートパターン

---

## 概要

全てのワークフローは、重要なフェーズ移行前に**ユーザーの明示的な承認**を必要とする。

**原則**: ユーザーからの明示的な応答があるまで次のフェーズに進んではならない。

---

## 承認ゲートの種類

| ワークフロー | フェーズ | 合格基準 | 次のアクション |
|-------------|---------|---------|---------------|
| `/req-workflow` | Phase 2.5 | 8点以上 | 基本設計へ |
| `/basic-design-workflow` | Phase 2.5 | 9点以上 | 詳細設計準備へ |
| `/detailed-design-workflow` | Phase 4.5 | 9点以上 | Issue作成へ |
| `/implement-issues` | Phase 7.1 | 9点以上 | PR作成へ |

---

## 出力フォーマット

### 設計ワークフロー用（共通テンプレート）

```markdown
---
## 🔔 承認リクエスト: {ドキュメント種別}レビュー完了

### レビュー結果サマリー
| 項目 | 結果 |
|------|------|
| 最終スコア | X/10点 |
| レビュー回数 | Y回 |
| 合格基準 | {N}点以上 ✅ |

### 成果物
- **パス**: `{file_path}`

### 主要な内容（抜粋）
{summary_table_or_list}

### 未解決課題（あれば）
| ID | 課題 | 対応方針 |
|----|------|---------|
| I-XXX | [課題] | [方針] |

---
**次のアクション**: {next_action}

⏸️ **承認待ち**: 続行してよろしいですか？
- `続行` → {continue_action}
- `修正` → 指摘箇所を修正
- `中断` → ワークフローを終了
---
```

### 実装ワークフロー用（PR作成承認）

```markdown
## ✅ 品質レビュー通過 - PR作成承認リクエスト

### Issue情報
- **Issue**: #{issue_id} - {issue_title}
- **ブランチ**: `feature/issue-{issue_id}-{description}`

### レビュー結果
- **スコア**: {score}/10
- **レビュアー**: {reviewer_agent}

### 変更概要
- 新規ファイル: {new_files_count}件
- 変更ファイル: {modified_files_count}件
- 削除ファイル: {deleted_files_count}件

### 主な変更内容
{change_summary}

### テスト結果
- 合計: {total_tests}件
- 成功: {passed_tests}件
- 失敗: {failed_tests}件

---

**PR作成を承認しますか？**
- `続行`: PR作成を続行
- `修正`: 追加修正が必要（指摘箇所をコメントしてください）
- `下書き`: Draft PRとして作成
```

---

## ユーザー回答と対応アクション

### 設計ワークフロー共通

| ユーザー回答 | アクション |
|------------|----------|
| `続行` | 次のフェーズへ進む |
| `修正` + フィードバック | 指摘箇所を修正し、再レビュー |
| `中断` | ワークフローを終了（成果物は保持） |

### 実装ワークフロー（PR作成）

| ユーザー回答 | アクション |
|------------|----------|
| `続行` | 通常PRを作成 |
| `下書き` | Draft PRを作成（`--draft`フラグ付き） |
| `修正` + フィードバック | 指摘箇所を修正 → 再レビュー |
| タイムアウト（30分） | Draft PRを自動作成、ユーザーに通知 |

---

## タイムアウト仕様（実装ワークフローのみ）

| パラメータ | 値 | 説明 |
|----------|-----|------|
| タイムアウト時間 | 30分 | ユーザー応答の待機上限 |
| タイムアウト時の挙動 | Draft PR作成 | 作業成果を保全 |
| 再開方法 | PRページで承認/修正指示 | Draft解除またはコメント |

---

## 実装ガイドライン

1. **承認待ち状態を明示**: `⏸️ 承認待ち` マークを必ず表示
2. **選択肢を明確に**: 3択（続行/修正/中断 or 下書き）を提示
3. **次のアクションを予告**: 承認後に何が起こるか説明
4. **応答なしで進まない**: ユーザー応答がない限りブロック
