# ワークフローPhase命名規約

> **参照元**: 全ワークフロー（req-workflow, basic-design-workflow, detailed-design-workflow, implement-issues）

---

## 概要

全ワークフローで一貫したPhase番号体系を使用し、ユーザーの理解を容易にする。

---

## Phase番号体系

### 標準Phase構成

| Phase | 名称 | 目的 |
|-------|------|------|
| **Phase 0** | コンテキスト収集 | 入力の解析、必要情報の収集 |
| **Phase 0.5** | 既存ドキュメント整合性確認 | 既存成果物との整合性チェック（追加仕様時のみ） |
| **Phase 1** | 主要作業（作成/実装） | ワークフローの主目的を実行 |
| **Phase 2** | レビューループ | 品質保証のための反復レビュー |
| **Phase 2.5** | ユーザー承認ゲート | 次フェーズ移行前の明示的承認 |
| **Phase 3** | 後処理/成果物出力 | 最終出力、次ワークフローへの引き継ぎ |

### 拡張Phase（大規模ワークフロー用）

| Phase | 名称 | 使用例 |
|-------|------|--------|
| **Phase 1.5** | 中間検証 | ASCII禁止チェック、モックアップ検証 |
| **Phase 4** | 追加作業 | Issue作成、テスト項目書作成 |
| **Phase 4.5** | 追加承認ゲート | Issue化前の承認 |
| **Phase 5+** | 実装固有フェーズ | TDD、CI監視、PR作成 |

---

## ワークフロー別Phase対応表

### 設計系ワークフロー（3フェーズ構成）

| Phase | req-workflow | basic-design-workflow | detailed-design-workflow |
|-------|--------------|----------------------|-------------------------|
| 0 | コンテキスト収集 | コンテキスト収集 | コンテキスト収集 |
| 0.5 | 既存要件整合性確認 | 技術ヒアリング + 既存設計確認 | 既存システム影響分析 |
| 1 | 要件定義書作成 | 基本設計書作成 | 詳細設計書作成 |
| 1.5 | - | - | ASCII/モックアップ検証 |
| 2 | レビューループ（5回） | レビューループ（3回） | レビューループ（3回） |
| 2.5 | ユーザー承認ゲート | ユーザー承認ゲート | - |
| 3 | 成果物サマリー | 詳細設計準備 | テスト項目書作成 |
| 4 | - | - | Issue作成 |
| 4.5 | - | - | ユーザー承認ゲート |

### 実装系ワークフロー（7+フェーズ構成）

| Phase | implement-issues | bug-fix-workflow |
|-------|-----------------|------------------|
| 1 | Issue選択・分析 | バグ報告分析 |
| 2 | 環境構築 | 環境構築 |
| 3 | 設計書確認 | 原因調査 |
| 4 | TDD実装 | 修正実装 |
| 5 | Lint & Test | Lint & Test |
| 6 | 品質レビュー | 品質レビュー |
| 6.5 | ユーザー承認ゲート | ユーザー承認ゲート |
| 7 | PR作成・CI監視 | PR作成・CI監視 |

---

## 承認ゲート規約

### 命名規則

承認ゲートは **「直前の主要Phaseの後」** に `.5` を付与：

```
Phase X（主要作業） → Phase X.5（承認ゲート） → Phase X+1（次の作業）
```

### 承認ゲート配置基準

| 条件 | 承認ゲート必須 |
|------|---------------|
| 外部成果物を生成する直前 | ✅ |
| 不可逆な操作の直前（PR作成、Issue作成） | ✅ |
| 単なる中間処理 | ❌ |

---

## Phase 0.5 の統一仕様

### 目的

既存プロジェクトへの追加仕様時に、既存ドキュメント・コードとの整合性を確認する。

### 実行条件

| 条件 | Phase 0.5 |
|------|----------|
| 新規プロジェクト | スキップ |
| 既存プロジェクトへの追加 | 実行 |
| ユーザーが明示的にスキップ指示 | スキップ |

### 共通出力フォーマット

```markdown
## 既存ドキュメント整合性確認結果

### 関連する既存ドキュメント
| ドキュメント | 関連度 | 影響 |
|-------------|--------|------|
| {パス} | 高/中/低 | {影響内容} |

### 整合性チェック結果
| 項目 | ステータス | 備考 |
|------|----------|------|
| {チェック項目} | ✅ OK / ⚠️ 要確認 / ❌ 不整合 | {詳細} |

### 対応方針
- `続行` → 整合性確認OK、次フェーズへ
- `調整` → 既存ドキュメントと調整後に続行
- `中断` → 確認後に再開
```

---

## 最大リトライ回数

| ワークフロー | 最大リトライ | 理由 |
|-------------|-------------|------|
| req-workflow | 5回 | 要件は曖昧になりやすく、反復が必要 |
| basic-design-workflow | 3回 | 技術的判断が明確、収束が早い |
| detailed-design-workflow | 3回 | 基本設計に基づくため収束が早い |
| implement-issues | 3回 | コードは客観的に検証可能 |

---

## 変更履歴

| 日付 | 変更内容 |
|------|---------|
| 2026-01-08 | 初版作成。全ワークフローのPhase番号を標準化 |
