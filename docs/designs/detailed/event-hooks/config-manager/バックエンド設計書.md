# Config Manager ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è¨­è¨ˆæ›¸

## 1. ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«æ§‹æˆ

### 1.1 ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
src/hooks/
â”œâ”€â”€ mod.rs               # ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
â”œâ”€â”€ executor.rs          # HookExecutorå®Ÿè£…
â”œâ”€â”€ config.rs            # HookConfigã€HookDefinitionï¼ˆæœ¬è¨­è¨ˆæ›¸ï¼‰
â””â”€â”€ context.rs           # HookContextã€ç’°å¢ƒå¤‰æ•°ç”Ÿæˆ
```

### 1.2 ä¾å­˜é–¢ä¿‚

```rust
// src/hooks/config.rs

use anyhow::{Context, Result};
use serde::{Deserialize, Serialize};
use std::collections::HashMap;
use std::path::PathBuf;
use tracing::{info, warn};
```

## 2. ãƒ‡ãƒ¼ã‚¿æ§‹é€ 

### 2.1 HookConfig

```rust
/// ãƒ•ãƒƒã‚¯è¨­å®š
///
/// ~/.pomodoro/hooks.json ã®å†…å®¹ã‚’è¡¨ç¾ã™ã‚‹æ§‹é€ ä½“ã€‚
/// Daemonèµ·å‹•æ™‚ã«1å›ã®ã¿èª­ã¿è¾¼ã¾ã‚Œã€ãƒ¡ãƒ¢ãƒªã«ä¿æŒã•ã‚Œã‚‹ã€‚
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct HookConfig {
    /// ã‚¤ãƒ™ãƒ³ãƒˆã”ã¨ã®ãƒ•ãƒƒã‚¯å®šç¾©
    /// ã‚­ãƒ¼: ã‚¤ãƒ™ãƒ³ãƒˆåï¼ˆ"work_end", "break_start"ç­‰ï¼‰
    /// å€¤: ãƒ•ãƒƒã‚¯å®šç¾©ã®ãƒªã‚¹ãƒˆ
    pub hooks: HashMap<String, Vec<HookDefinition>>,
    
    /// ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰
    /// ãƒ•ãƒƒã‚¯å€‹åˆ¥ã®ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒæœªè¨­å®šã®å ´åˆã«ä½¿ç”¨ã•ã‚Œã‚‹
    #[serde(default = "default_timeout")]
    pub global_timeout: u32,
}

fn default_timeout() -> u32 {
    30
}

impl HookConfig {
    /// è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿
    ///
    /// # å‡¦ç†ãƒ•ãƒ­ãƒ¼
    /// 1. ~/.pomodoro/hooks.json ã®ãƒ‘ã‚¹ã‚’æ§‹ç¯‰
    /// 2. ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª
    /// 3. ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
    /// 4. JSONè§£æ
    /// 5. ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
    /// 6. æˆåŠŸæ™‚: Some(HookConfig)ã€å¤±æ•—æ™‚: None
    ///
    /// # æˆ»ã‚Šå€¤
    /// - `Some(HookConfig)`: èª­ã¿è¾¼ã¿æˆåŠŸ
    /// - `None`: ãƒ•ã‚¡ã‚¤ãƒ«ä¸å­˜åœ¨ã€è§£æå¤±æ•—ã€ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³å¤±æ•—
    pub fn load() -> Option<Self> {
        let config_path = dirs::home_dir()
            .expect("ãƒ›ãƒ¼ãƒ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªãŒå–å¾—ã§ãã¾ã›ã‚“")
            .join(".pomodoro")
            .join("hooks.json");
        
        if !config_path.exists() {
            info!("ãƒ•ãƒƒã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: {:?}", config_path);
            return None;
        }
        
        match std::fs::read_to_string(&config_path) {
            Ok(content) => match serde_json::from_str::<Self>(&content) {
                Ok(config) => {
                    if let Err(e) = config.validate() {
                        warn!("ãƒ•ãƒƒã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: {}", e);
                        return None;
                    }
                    
                    let total_hooks: usize = config.hooks.values()
                        .map(|v| v.len())
                        .sum();
                    info!("ãƒ•ãƒƒã‚¯è¨­å®šã‚’èª­ã¿è¾¼ã¿ã¾ã—ãŸï¼ˆ{}ã‚¤ãƒ™ãƒ³ãƒˆã€{}ãƒ•ãƒƒã‚¯ï¼‰", 
                        config.hooks.len(), total_hooks);
                    
                    Some(config)
                }
                Err(e) => {
                    warn!("ãƒ•ãƒƒã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: {:?}", e);
                    None
                }
            },
            Err(e) => {
                warn!("ãƒ•ãƒƒã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®èª­ã¿è¾¼ã¿ã«å¤±æ•—ã—ã¾ã—ãŸ: {:?}", e);
                None
            }
        }
    }
    
    /// è¨­å®šã‚’æ¤œè¨¼
    ///
    /// # æ¤œè¨¼é …ç›®
    /// 1. ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ç¯„å›²ï¼ˆ1-300ç§’ï¼‰
    /// 2. ã‚¤ãƒ™ãƒ³ãƒˆåã®å¦¥å½“æ€§ï¼ˆ9ç¨®é¡ã®ã‚¤ãƒ™ãƒ³ãƒˆåã®ã¿è¨±å¯ï¼‰
    /// 3. ãƒ•ãƒƒã‚¯æ•°ã®ä¸Šé™ï¼ˆ1ã‚¤ãƒ™ãƒ³ãƒˆã‚ãŸã‚Š10å€‹ã¾ã§ï¼‰
    /// 4. å„ãƒ•ãƒƒã‚¯å®šç¾©ã®å¦¥å½“æ€§
    ///
    /// # ã‚¨ãƒ©ãƒ¼
    /// - ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç¯„å›²å¤–
    /// - ç„¡åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆå
    /// - ãƒ•ãƒƒã‚¯æ•°ãŒä¸Šé™è¶…é
    /// - ãƒ•ãƒƒã‚¯å®šç¾©ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼
    pub fn validate(&self) -> Result<(), String> {
        // 1. ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ç¯„å›²ãƒã‚§ãƒƒã‚¯
        if self.global_timeout < 1 || self.global_timeout > 300 {
            return Err(format!(
                "global_timeoutã¯1-300ç§’ã®ç¯„å›²ã§æŒ‡å®šã—ã¦ãã ã•ã„ï¼ˆç¾åœ¨å€¤: {}ç§’ï¼‰",
                self.global_timeout
            ));
        }
        
        // 2. å„ã‚¤ãƒ™ãƒ³ãƒˆã®ãƒ•ãƒƒã‚¯å®šç¾©ã‚’æ¤œè¨¼
        for (event_name, hooks) in &self.hooks {
            // ã‚¤ãƒ™ãƒ³ãƒˆåã®æ¤œè¨¼
            if !is_valid_event_name(event_name) {
                return Err(format!(
                    "ç„¡åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆåã§ã™: '{}'\næœ‰åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆå: work_start, work_end, break_start, break_end, long_break_start, long_break_end, pause, resume, stop",
                    event_name
                ));
            }
            
            // ãƒ•ãƒƒã‚¯æ•°ã®ä¸Šé™ãƒã‚§ãƒƒã‚¯
            if hooks.len() > 10 {
                return Err(format!(
                    "ã‚¤ãƒ™ãƒ³ãƒˆ '{}' ã®ãƒ•ãƒƒã‚¯æ•°ãŒä¸Šé™ï¼ˆ10å€‹ï¼‰ã‚’è¶…ãˆã¦ã„ã¾ã™ï¼ˆç¾åœ¨: {}å€‹ï¼‰",
                    event_name,
                    hooks.len()
                ));
            }
            
            // å„ãƒ•ãƒƒã‚¯å®šç¾©ã‚’æ¤œè¨¼
            for (index, hook) in hooks.iter().enumerate() {
                if let Err(e) = hook.validate() {
                    return Err(format!(
                        "ã‚¤ãƒ™ãƒ³ãƒˆ '{}' ã®ãƒ•ãƒƒã‚¯[{}] '{}' ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: {}",
                        event_name,
                        index,
                        hook.name,
                        e
                    ));
                }
            }
        }
        
        Ok(())
    }
}

/// æœ‰åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆåã‹ãƒã‚§ãƒƒã‚¯
///
/// # å¼•æ•°
/// - `name`: ã‚¤ãƒ™ãƒ³ãƒˆå
///
/// # æˆ»ã‚Šå€¤
/// - `true`: æœ‰åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆåï¼ˆ9ç¨®é¡ã®ã„ãšã‚Œã‹ï¼‰
/// - `false`: ç„¡åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆå
fn is_valid_event_name(name: &str) -> bool {
    matches!(
        name,
        "work_start"
            | "work_end"
            | "break_start"
            | "break_end"
            | "long_break_start"
            | "long_break_end"
            | "pause"
            | "resume"
            | "stop"
    )
}
```

### 2.2 HookDefinition

```rust
/// å€‹åˆ¥ãƒ•ãƒƒã‚¯ã®å®šç¾©
///
/// 1ã¤ã®ãƒ•ãƒƒã‚¯ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¨­å®šã‚’è¡¨ç¾ã™ã‚‹æ§‹é€ ä½“ã€‚
#[derive(Debug, Clone, Serialize, Deserialize)]
pub struct HookDefinition {
    /// ãƒ•ãƒƒã‚¯åï¼ˆè­˜åˆ¥ç”¨ï¼‰
    /// ä¾‹: "Slacké€šçŸ¥", "ãƒ¡ãƒ¼ãƒ«é€ä¿¡"
    pub name: String,
    
    /// ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®çµ¶å¯¾ãƒ‘ã‚¹
    /// ä¾‹: "/Users/user/.pomodoro/scripts/notify-slack.sh"
    pub script: PathBuf,
    
    /// æœ‰åŠ¹/ç„¡åŠ¹
    /// false ã®å ´åˆã€ã“ã®ãƒ•ãƒƒã‚¯ã¯å®Ÿè¡Œã•ã‚Œãªã„
    #[serde(default = "default_enabled")]
    pub enabled: bool,
    
    /// ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ï¼ˆç§’ï¼‰
    /// None ã®å ´åˆã€global_timeout ã‚’ä½¿ç”¨
    pub timeout: Option<u32>,
}

fn default_enabled() -> bool {
    true
}

impl HookDefinition {
    /// ãƒ•ãƒƒã‚¯å®šç¾©ã‚’æ¤œè¨¼
    ///
    /// # æ¤œè¨¼é …ç›®
    /// 1. ãƒ•ãƒƒã‚¯åã®é•·ã•ï¼ˆ1-100æ–‡å­—ï¼‰
    /// 2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ãŒçµ¶å¯¾ãƒ‘ã‚¹ã§ã‚ã‚‹ã“ã¨
    /// 3. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ç¯„å›²ï¼ˆ1-300ç§’ï¼‰
    ///
    /// # ã‚¨ãƒ©ãƒ¼
    /// - ãƒ•ãƒƒã‚¯åãŒç©ºæ–‡å­—åˆ—
    /// - ãƒ•ãƒƒã‚¯åãŒ100æ–‡å­—è¶…é
    /// - ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ãŒç›¸å¯¾ãƒ‘ã‚¹
    /// - ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆãŒç¯„å›²å¤–
    pub fn validate(&self) -> Result<(), String> {
        // 1. ãƒ•ãƒƒã‚¯åã®é•·ã•ãƒã‚§ãƒƒã‚¯
        if self.name.is_empty() {
            return Err("ãƒ•ãƒƒã‚¯åã¯å¿…é ˆã§ã™".to_string());
        }
        if self.name.len() > 100 {
            return Err(format!(
                "ãƒ•ãƒƒã‚¯åã¯100æ–‡å­—ä»¥å†…ã§æŒ‡å®šã—ã¦ãã ã•ã„ï¼ˆç¾åœ¨: {}æ–‡å­—ï¼‰",
                self.name.len()
            ));
        }
        
        // 2. ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ã®æ¤œè¨¼
        if !self.script.is_absolute() {
            return Err(format!(
                "ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ã¯çµ¶å¯¾ãƒ‘ã‚¹ã§æŒ‡å®šã—ã¦ãã ã•ã„: {:?}\nä¾‹: /Users/user/.pomodoro/scripts/notify.sh",
                self.script
            ));
        }
        
        // 3. ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã®ç¯„å›²ãƒã‚§ãƒƒã‚¯
        if let Some(timeout) = self.timeout {
            if timeout < 1 || timeout > 300 {
                return Err(format!(
                    "timeoutã¯1-300ç§’ã®ç¯„å›²ã§æŒ‡å®šã—ã¦ãã ã•ã„ï¼ˆç¾åœ¨å€¤: {}ç§’ï¼‰",
                    timeout
                ));
            }
        }
        
        Ok(())
    }
}
```

## 3. JSONã‚¹ã‚­ãƒ¼ãƒ

### 3.1 ã‚¹ã‚­ãƒ¼ãƒå®šç¾©

```json
{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "type": "object",
  "properties": {
    "hooks": {
      "type": "object",
      "description": "ã‚¤ãƒ™ãƒ³ãƒˆã”ã¨ã®ãƒ•ãƒƒã‚¯å®šç¾©",
      "patternProperties": {
        "^(work_start|work_end|break_start|break_end|long_break_start|long_break_end|pause|resume|stop)$": {
          "type": "array",
          "description": "ã‚¤ãƒ™ãƒ³ãƒˆã«ç™»éŒ²ã™ã‚‹ãƒ•ãƒƒã‚¯ã®ãƒªã‚¹ãƒˆ",
          "items": {
            "type": "object",
            "properties": {
              "name": {
                "type": "string",
                "description": "ãƒ•ãƒƒã‚¯ã®åå‰ï¼ˆè­˜åˆ¥ç”¨ï¼‰",
                "minLength": 1,
                "maxLength": 100
              },
              "script": {
                "type": "string",
                "description": "ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®çµ¶å¯¾ãƒ‘ã‚¹",
                "pattern": "^/"
              },
              "enabled": {
                "type": "boolean",
                "description": "ãƒ•ãƒƒã‚¯ã®æœ‰åŠ¹/ç„¡åŠ¹",
                "default": true
              },
              "timeout": {
                "type": "number",
                "description": "ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆæ™‚é–“ï¼ˆç§’ï¼‰",
                "minimum": 1,
                "maximum": 300
              }
            },
            "required": ["name", "script"]
          },
          "maxItems": 10
        }
      }
    },
    "global_timeout": {
      "type": "number",
      "description": "ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆï¼ˆç§’ï¼‰",
      "minimum": 1,
      "maximum": 300,
      "default": 30
    }
  },
  "required": ["hooks"]
}
```

### 3.2 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä¾‹

#### åŸºæœ¬è¨­å®š

```json
{
  "hooks": {
    "work_end": [
      {
        "name": "Slacké€šçŸ¥",
        "script": "/Users/user/.pomodoro/scripts/notify-slack.sh",
        "enabled": true,
        "timeout": 10
      }
    ]
  },
  "global_timeout": 30
}
```

#### è¤‡æ•°ãƒ•ãƒƒã‚¯è¨­å®š

```json
{
  "hooks": {
    "work_end": [
      {
        "name": "Slacké€šçŸ¥",
        "script": "/Users/user/.pomodoro/scripts/notify-slack.sh",
        "enabled": true,
        "timeout": 10
      },
      {
        "name": "çµ±è¨ˆè¨˜éŒ²",
        "script": "/Users/user/.pomodoro/scripts/record-stats.sh",
        "enabled": true,
        "timeout": 5
      }
    ],
    "break_start": [
      {
        "name": "éŸ³æ¥½å†ç”Ÿ",
        "script": "/Users/user/.pomodoro/scripts/play-music.sh",
        "enabled": false,
        "timeout": 5
      }
    ],
    "break_end": [
      {
        "name": "éŸ³æ¥½åœæ­¢",
        "script": "/Users/user/.pomodoro/scripts/play-music.sh",
        "enabled": true
      }
    ]
  },
  "global_timeout": 30
}
```

## 4. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### 4.1 ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ã¨å¯¾å‡¦

| ã‚¨ãƒ©ãƒ¼ç¨®åˆ¥ | ã‚¨ãƒ©ãƒ¼ã‚³ãƒ¼ãƒ‰ | æ¤œå‡ºã‚¿ã‚¤ãƒŸãƒ³ã‚° | å¯¾å‡¦ | ãƒ­ã‚°ãƒ¬ãƒ™ãƒ« |
|-----------|-------------|---------------|------|-----------|
| ãƒ•ã‚¡ã‚¤ãƒ«ä¸å­˜åœ¨ | E030 | `HookConfig::load()` | ãƒ•ãƒƒã‚¯æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ– | INFO |
| JSONè§£æã‚¨ãƒ©ãƒ¼ | E031 | `serde_json::from_str()` | ãƒ•ãƒƒã‚¯æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ– | WARN |
| ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ | E031 | `validate()` | ãƒ•ãƒƒã‚¯æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ– | WARN |
| ç„¡åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆå | E031 | `is_valid_event_name()` | ãƒ•ãƒƒã‚¯æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ– | WARN |
| ãƒ•ãƒƒã‚¯æ•°ä¸Šé™è¶…é | E031 | `validate()` | ãƒ•ãƒƒã‚¯æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ– | WARN |
| ç„¡åŠ¹ãªã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ | E031 | `HookDefinition::validate()` | ãƒ•ãƒƒã‚¯æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ– | WARN |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆç¯„å›²å¤– | E031 | `validate()` | ãƒ•ãƒƒã‚¯æ©Ÿèƒ½ã‚’ç„¡åŠ¹åŒ– | WARN |

### 4.2 ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ä¾‹

```
[2026-01-06 10:00:00] [INFO] ãƒ•ãƒƒã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“: "/Users/user/.pomodoro/hooks.json"
[2026-01-06 10:00:00] [WARN] ãƒ•ãƒƒã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®è§£æã«å¤±æ•—ã—ã¾ã—ãŸ: Error("expected value", line: 5, column: 3)
[2026-01-06 10:00:00] [WARN] ãƒ•ãƒƒã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: global_timeoutã¯1-300ç§’ã®ç¯„å›²ã§æŒ‡å®šã—ã¦ãã ã•ã„ï¼ˆç¾åœ¨å€¤: 500ç§’ï¼‰
[2026-01-06 10:00:00] [WARN] ãƒ•ãƒƒã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: ç„¡åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆåã§ã™: 'custom_event'
æœ‰åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆå: work_start, work_end, break_start, break_end, long_break_start, long_break_end, pause, resume, stop
[2026-01-06 10:00:00] [WARN] ãƒ•ãƒƒã‚¯è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: ã‚¤ãƒ™ãƒ³ãƒˆ 'work_end' ã®ãƒ•ãƒƒã‚¯[2] 'ãƒ¡ãƒ¼ãƒ«é€ä¿¡' ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼: ã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ‘ã‚¹ã¯çµ¶å¯¾ãƒ‘ã‚¹ã§æŒ‡å®šã—ã¦ãã ã•ã„: "./scripts/send-email.sh"
ä¾‹: /Users/user/.pomodoro/scripts/notify.sh
```

## 5. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆã‚¬ã‚¤ãƒ‰

### 5.1 åˆæœŸè¨­å®šæ‰‹é †

```bash
# 1. è¨­å®šãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ä½œæˆ
mkdir -p ~/.pomodoro/scripts

# 2. è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > ~/.pomodoro/hooks.json <<'EOF'
{
  "hooks": {
    "work_end": [
      {
        "name": "Slacké€šçŸ¥",
        "script": "/Users/USERNAME/.pomodoro/scripts/notify-slack.sh",
        "enabled": true,
        "timeout": 10
      }
    ]
  },
  "global_timeout": 30
}
EOF

# 3. ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆ
cat > ~/.pomodoro/scripts/notify-slack.sh <<'EOF'
#!/bin/bash
WEBHOOK_URL="https://hooks.slack.com/services/YOUR/WEBHOOK/URL"
MESSAGE="ğŸ… ãƒãƒ¢ãƒ‰ãƒ¼ãƒ­ #${POMODORO_COUNT} å®Œäº†: ${POMODORO_TASK}"
curl -X POST "$WEBHOOK_URL" \
  -H 'Content-Type: application/json' \
  -d "{\"text\": \"${MESSAGE}\"}" \
  --max-time 10 \
  --silent \
  --show-error
EOF

# 4. å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸
chmod +x ~/.pomodoro/scripts/notify-slack.sh

# 5. Daemonã‚’å†èµ·å‹•
pomodoro stop
pomodoro start
```

### 5.2 è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

```bash
# JSONã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯
cat ~/.pomodoro/hooks.json | jq .

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å­˜åœ¨ç¢ºèª
ls -l ~/.pomodoro/scripts/

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®å®Ÿè¡Œæ¨©é™ç¢ºèª
ls -l ~/.pomodoro/scripts/*.sh

# ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®æ‰‹å‹•å®Ÿè¡Œãƒ†ã‚¹ãƒˆ
POMODORO_EVENT=work_end \
POMODORO_TASK="ãƒ†ã‚¹ãƒˆ" \
POMODORO_COUNT=1 \
~/.pomodoro/scripts/notify-slack.sh
```

## 6. ãƒ†ã‚¹ãƒˆæ–¹é‡

### 6.1 å˜ä½“ãƒ†ã‚¹ãƒˆ

```rust
#[cfg(test)]
mod tests {
    use super::*;
    use std::fs;
    use tempfile::TempDir;
    
    #[test]
    fn test_hook_config_validate_success() {
        let config = HookConfig {
            hooks: HashMap::new(),
            global_timeout: 30,
        };
        
        assert!(config.validate().is_ok());
    }
    
    #[test]
    fn test_hook_config_validate_timeout_out_of_range() {
        let config = HookConfig {
            hooks: HashMap::new(),
            global_timeout: 500,
        };
        
        let result = config.validate();
        assert!(result.is_err());
        assert!(result.unwrap_err().contains("1-300ç§’"));
    }
    
    #[test]
    fn test_hook_config_validate_invalid_event_name() {
        let mut hooks = HashMap::new();
        hooks.insert("invalid_event".to_string(), vec![]);
        
        let config = HookConfig {
            hooks,
            global_timeout: 30,
        };
        
        let result = config.validate();
        assert!(result.is_err());
        assert!(result.unwrap_err().contains("ç„¡åŠ¹ãªã‚¤ãƒ™ãƒ³ãƒˆå"));
    }
    
    #[test]
    fn test_hook_config_validate_too_many_hooks() {
        let mut hooks_vec = vec![];
        for i in 0..11 {
            hooks_vec.push(HookDefinition {
                name: format!("ãƒ•ãƒƒã‚¯{}", i),
                script: PathBuf::from(format!("/tmp/hook{}.sh", i)),
                enabled: true,
                timeout: None,
            });
        }
        
        let mut hooks = HashMap::new();
        hooks.insert("work_end".to_string(), hooks_vec);
        
        let config = HookConfig {
            hooks,
            global_timeout: 30,
        };
        
        let result = config.validate();
        assert!(result.is_err());
        assert!(result.unwrap_err().contains("ä¸Šé™ï¼ˆ10å€‹ï¼‰ã‚’è¶…ãˆã¦ã„ã¾ã™"));
    }
    
    #[test]
    fn test_hook_definition_validate_success() {
        let hook = HookDefinition {
            name: "ãƒ†ã‚¹ãƒˆãƒ•ãƒƒã‚¯".to_string(),
            script: PathBuf::from("/tmp/test.sh"),
            enabled: true,
            timeout: Some(10),
        };
        
        assert!(hook.validate().is_ok());
    }
    
    #[test]
    fn test_hook_definition_validate_empty_name() {
        let hook = HookDefinition {
            name: "".to_string(),
            script: PathBuf::from("/tmp/test.sh"),
            enabled: true,
            timeout: None,
        };
        
        let result = hook.validate();
        assert!(result.is_err());
        assert!(result.unwrap_err().contains("ãƒ•ãƒƒã‚¯åã¯å¿…é ˆ"));
    }
    
    #[test]
    fn test_hook_definition_validate_relative_path() {
        let hook = HookDefinition {
            name: "ãƒ†ã‚¹ãƒˆãƒ•ãƒƒã‚¯".to_string(),
            script: PathBuf::from("./scripts/test.sh"),
            enabled: true,
            timeout: None,
        };
        
        let result = hook.validate();
        assert!(result.is_err());
        assert!(result.unwrap_err().contains("çµ¶å¯¾ãƒ‘ã‚¹"));
    }
    
    #[test]
    fn test_is_valid_event_name() {
        assert!(is_valid_event_name("work_start"));
        assert!(is_valid_event_name("work_end"));
        assert!(is_valid_event_name("break_start"));
        assert!(is_valid_event_name("break_end"));
        assert!(is_valid_event_name("long_break_start"));
        assert!(is_valid_event_name("long_break_end"));
        assert!(is_valid_event_name("pause"));
        assert!(is_valid_event_name("resume"));
        assert!(is_valid_event_name("stop"));
        
        assert!(!is_valid_event_name("invalid"));
        assert!(!is_valid_event_name("custom_event"));
    }
}
```

### 6.2 çµ±åˆãƒ†ã‚¹ãƒˆ

```rust
// tests/config_integration_test.rs

use std::fs;
use tempfile::TempDir;

#[test]
fn test_load_valid_config() {
    let temp_dir = TempDir::new().unwrap();
    let config_path = temp_dir.path().join("hooks.json");
    
    let config_json = r#"
    {
      "hooks": {
        "work_end": [
          {
            "name": "ãƒ†ã‚¹ãƒˆãƒ•ãƒƒã‚¯",
            "script": "/tmp/test.sh",
            "enabled": true,
            "timeout": 10
          }
        ]
      },
      "global_timeout": 30
    }
    "#;
    
    fs::write(&config_path, config_json).unwrap();
    
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
}

#[test]
fn test_load_invalid_json() {
    let temp_dir = TempDir::new().unwrap();
    let config_path = temp_dir.path().join("hooks.json");
    
    let invalid_json = r#"
    {
      "hooks": {
        "work_end": [
          {
            "name": "ãƒ†ã‚¹ãƒˆãƒ•ãƒƒã‚¯",
            "script": "/tmp/test.sh",
            "enabled": true,
            "timeout": 10
          }
        ]
      },
      "global_timeout": 30
    "#; // é–‰ã˜æ‹¬å¼§ãªã—
    
    fs::write(&config_path, invalid_json).unwrap();
    
    // ãƒ†ã‚¹ãƒˆå®Ÿè£…
}
```

---

## å¤‰æ›´å±¥æ­´

| æ—¥ä»˜ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | å¤‰æ›´å†…å®¹ | æ‹…å½“è€… |
|:---|:---|:---|:---|
| 2026-01-06 | 1.0.0 | åˆç‰ˆä½œæˆ | - |
