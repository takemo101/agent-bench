# フォーカスモード連携セットアップ

Pomodoro Timer CLIは、macOSの「集中モード (Focus Mode)」と連携し、作業開始時に自動で集中モードをオンにし、休憩時にオフにすることができます。

この機能を使用するには、macOSの「ショートカット (Shortcuts)」アプリで専用のショートカットを作成する必要があります。

## セットアップ手順

### 1. ショートカットアプリを開く
Spotlight検索などで「ショートカット.app (Shortcuts.app)」を開きます。

### 2. 新規ショートカットを作成
ツールバーの「+」ボタンをクリックして、新しいショートカットを作成します。

### 3. ショートカット名を設定
ショートカットの名前を **"Focus Mode"** に設定してください。
※ 大文字小文字を含めて正確に入力してください。

### 4. アクションを追加
1. 右側のサイドバーで「集中モードを設定 (Set Focus)」を検索します。
2. アクションをエディタ領域にドラッグ＆ドロップします。
3. アクションの設定を変更します:
   - 「**おやすみモード**を**オン**にする」のようになっている部分をクリックして変更できます。
   - 「**オン**」の部分を右クリック（またはCtrl+クリック）し、「**変数を選択...**」ではなく、「**毎回尋ねる (Ask Each Time)**」に変更できる場合は変更しますが、
   - CLIからは引数として「オン/オフ」を渡すため、ショートカット側は入力を受け付けるようにする必要があります。

**推奨設定:**
より確実な方法は、CLIが直接ショートカットを実行する際に引数を渡すことです。

現在の実装（v0.1.0）では、単純に特定のフォーカスモード（例: おやすみモード）をトグルする仕様になっています。

詳細なショートカット設定:
1. 右側のサイドバーで「スクリプト」カテゴリから「入力を受け取る (Receive Input)」を追加する、または「ショートカットの詳細」タブで「入力として使用 (Use as Input)」にチェックを入れます。
2. 入力が「テキスト」であることを確認します。
3. 「IF」文を追加して、入力が "on" なら集中モードをオン、"off" ならオフにするロジックを組むことも可能です。

**簡易セットアップ:**
現在のCLI実装は、macOSの `shortcuts run "Focus Mode"` コマンドを実行します。
デフォルトでは、このコマンドはショートカットを単に実行するだけです。

もし「作業中」という名前の集中モードを作成している場合:
1. ショートカット内で「集中モードを設定」アクションを追加。
2. 「**作業中**」を「**オン**」にする、に設定。
3. これだと「オン」にしかなりません。

v0.1.0では、フォーカスモード機能は「実験的」なステータスです。
将来のバージョンでより柔軟な制御（プロファイル指定など）が追加される予定です。

## トラブルシューティング

**Q. エラー "Shortcut not found" が出る**
A. ショートカット名が "Focus Mode" になっているか確認してください。

**Q. 集中モードが切り替わらない**
A. ショートカットを手動で実行して動作するか確認してください。また、macOSの「プライバシーとセキュリティ」設定で、ターミナル（またはiTerm2など）からのショートカット実行が許可されているか確認が必要な場合があります。
